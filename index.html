<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPE Compteur GAZ - Gestion des interventions</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        window.addEventListener('DOMContentLoaded', function() {
            const { useState, useEffect, createElement: h } = React;
            const { createRoot } = ReactDOM;

            // Ic√¥nes SVG simples
            const HomeIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('path', { d: 'M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z' }),
                h('polyline', { points: '9 22 9 12 15 12 15 22' })
            );

            const PlusIcon = () => h('svg', { width: 40, height: 40, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('line', { x1: 12, y1: 5, x2: 12, y2: 19 }),
                h('line', { x1: 5, y1: 12, x2: 19, y2: 12 })
            );

            const DownloadIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
                h('polyline', { points: '7 10 12 15 17 10' }),
                h('line', { x1: 12, y1: 15, x2: 12, y2: 3 })
            );

            const UploadIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
                h('polyline', { points: '17 8 12 3 7 8' }),
                h('line', { x1: 12, y1: 3, x2: 12, y2: 15 })
            );

            const SearchIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('circle', { cx: 11, cy: 11, r: 8 }),
                h('path', { d: 'm21 21-4.35-4.35' })
            );

            const SaveIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                h('path', { d: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z' }),
                h('polyline', { points: '17 21 17 13 7 13 7 21' }),
                h('polyline', { points: '7 3 7 8 15 8' })
            );

            function App() {
                const [interventions, setInterventions] = useState([]);
                const [currentView, setCurrentView] = useState('home');
                const [interventionType, setInterventionType] = useState('');
                const [searchTerm, setSearchTerm] = useState('');
                const [formData, setFormData] = useState({
                    visitBy: '',
                    interventionDate: '',
                    postNumber: '',
                    postName: '',
                    address: '',
                    commune: '',
                    arrivalTime: '',
                    departureTime: '',
                    removeMeterId: '',
                    removeMeterBrand: '',
                    removeMeterType: '',
                    removeMeterYear: '',
                    removeMeterLastCalib: '',
                    removeImpulsion: '',
                    removeCategory: 'Membranes',
                    removeAppellation: 'G16',
                    removeWheelsBefore: '',
                    removeWheelsAfter: '',
                    removeIndex: '',
                    removeFreeLabel: '',
                    installMeterId: '',
                    installMeterBrand: '',
                    installMeterType: '',
                    installMeterYear: '',
                    installMeterLastCalib: '',
                    installImpulsion: '',
                    installCategory: 'Membranes',
                    installAppellation: 'G16',
                    installWheelsBefore: '',
                    installWheelsAfter: '',
                    installIndex: '',
                    installFreeLabel: '',
                    telerelevantBeforeRef: '40000',
                    telerelevantBeforeSerial: '32',
                    telerelevantBeforeIndex1: '',
                    telerelevantBeforeIndex2: '',
                    telerelevantAfterSerial: '',
                    telerelevantAfterIndex1: '',
                    telerelevantAfterIndex2: '',
                    converterBeforeBrand: '',
                    converterBeforeIndex: '',
                    converterBeforeBase: '',
                    converterAfterSerial: '',
                    converterAfterIndex: '',
                    converterAfterBase: '',
                    photoVueGenerale: '',
                    photoCompteurDepose: '',
                    photoCompteurPose: '',
                    photoEtiquetteDLV: '',
                    photoEnvironnementPDL: '',
                    photoConvertisseur: '',
                    photoTelereleveAvant: '',
                    photoTelereleveApres: '',
                    maintenance: '',
                    photo: '',
                    sortieInfluance: '',
                    plaqueVS: '',
                    plaquePoste: '',
                    cello: '',
                    jointCompteur: '',
                    jointTorique: '',
                    jointPlat: '',
                    jointTamis: '',
                    flitre: '',
                    staubli: '',
                    mamelonMale: '',
                    teLaiton: '',
                    compteur: '',
                    antiRouille: '',
                    peinture: '',
                    couleurRAL: '',
                    boulonsEntree: '',
                    boulonsDiamEntree: '',
                    boulonsDiamSortie: '',
                    boulonsLongEntree: '',
                    boulonsLongSortie: '',
                    boulonsSortieQte: '',
                    dimensionHaut: '',
                    dimensionBas: '',
                    dimensionGauche: '',
                    dimensionDroite: '',
                    dimensionCentre: '',
                    hauteurCompteur: '',
                    commentaires: ''
                });

                useEffect(() => {
                    loadData();
                }, []);

                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('gasInterventions');
                        if (saved) {
                            setInterventions(JSON.parse(saved));
                        }
                    } catch (e) {
                        console.error('Erreur chargement:', e);
                    }
                };

                const handleInputChange = (e) => {
                    const { name, value } = e.target;
                    setFormData(prev => ({ ...prev, [name]: value }));
                };

                const handlePhotoCapture = (e, fieldName) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            setFormData(prev => ({ ...prev, [fieldName]: event.target.result }));
                        };
                        reader.readAsDataURL(file);
                    }
                };

                const handleSubmit = (e) => {
                    e.preventDefault();
                    const newIntervention = {
                        id: Date.now(),
                        type: interventionType,
                        ...formData,
                        createdAt: new Date().toISOString()
                    };
                    const updated = [...interventions, newIntervention];
                    setInterventions(updated);
                    localStorage.setItem('gasInterventions', JSON.stringify(updated));
                    alert('Intervention enregistr√©e avec succ√®s !');
                    resetForm();
                    setCurrentView('list');
                };

                const resetForm = () => {
                    setFormData({
                        visitBy: '',
                        interventionDate: '',
                        postNumber: '',
                        postName: '',
                        address: '',
                        commune: '',
                        arrivalTime: '',
                        departureTime: '',
                        removeMeterId: '',
                        removeMeterBrand: '',
                        removeMeterType: '',
                        removeMeterYear: '',
                        removeMeterLastCalib: '',
                        removeImpulsion: '',
                        removeCategory: 'Membranes',
                        removeAppellation: 'G16',
                        removeWheelsBefore: '',
                        removeWheelsAfter: '',
                        removeIndex: '',
                        removeFreeLabel: '',
                        installMeterId: '',
                        installMeterBrand: '',
                        installMeterType: '',
                        installMeterYear: '',
                        installMeterLastCalib: '',
                        installImpulsion: '',
                        installCategory: 'Membranes',
                        installAppellation: 'G16',
                        installWheelsBefore: '',
                        installWheelsAfter: '',
                        installIndex: '',
                        installFreeLabel: '',
                        telerelevantBeforeRef: '40000',
                        telerelevantBeforeSerial: '32',
                        telerelevantBeforeIndex1: '',
                        telerelevantBeforeIndex2: '',
                        telerelevantAfterSerial: '',
                        telerelevantAfterIndex1: '',
                        telerelevantAfterIndex2: '',
                        converterBeforeBrand: '',
                        converterBeforeIndex: '',
                        converterBeforeBase: '',
                        converterAfterSerial: '',
                        converterAfterIndex: '',
                        converterAfterBase: '',
                        photoVueGenerale: '',
                        photoCompteurDepose: '',
                        photoCompteurPose: '',
                        photoEtiquetteDLV: '',
                        photoEnvironnementPDL: '',
                        photoConvertisseur: '',
                        photoTelereleveAvant: '',
                        photoTelereleveApres: '',
                        maintenance: '',
                        photo: '',
                        sortieInfluance: '',
                        plaqueVS: '',
                        plaquePoste: '',
                        cello: '',
                        jointCompteur: '',
                        jointTorique: '',
                        jointPlat: '',
                        jointTamis: '',
                        flitre: '',
                        staubli: '',
                        mamelonMale: '',
                        teLaiton: '',
                        compteur: '',
                        antiRouille: '',
                        peinture: '',
                        couleurRAL: '',
                        boulonsEntree: '',
                        boulonsDiamEntree: '',
                        boulonsDiamSortie: '',
                        boulonsLongEntree: '',
                        boulonsLongSortie: '',
                        boulonsSortieQte: '',
                        dimensionHaut: '',
                        dimensionBas: '',
                        dimensionGauche: '',
                        dimensionDroite: '',
                        dimensionCentre: '',
                        hauteurCompteur: '',
                        commentaires: ''
                    });
                };

                const exportToCSV = () => {
                    if (interventions.length === 0) {
                        alert('Aucune donn√©e √† exporter');
                        return;
                    }

                    const headers = Object.keys(interventions[0]).join(',');
                    const rows = interventions.map(int => 
                        Object.values(int).map(val => `"${val}"`).join(',')
                    ).join('\n');
                    
                    const csv = headers + '\n' + rows;
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `interventions_gaz_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                };

                const importFromCSV = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const text = event.target.result;
                            const lines = text.split('\n');
                            const headers = lines[0].split(',');
                            
                            const imported = lines.slice(1).filter(line => line.trim()).map(line => {
                                const values = line.match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g).map(v => v.replace(/^"|"$/g, ''));
                                const obj = {};
                                headers.forEach((header, i) => {
                                    obj[header.trim()] = values[i] || '';
                                });
                                return obj;
                            });

                            setInterventions(imported);
                            localStorage.setItem('gasInterventions', JSON.stringify(imported));
                            alert(`${imported.length} interventions import√©es avec succ√®s !`);
                        } catch (error) {
                            alert('Erreur lors de l\'importation du fichier CSV');
                        }
                    };
                    reader.readAsText(file);
                };

                const deleteIntervention = (id) => {
                    if (confirm('√ätes-vous s√ªr de vouloir supprimer cette intervention ?')) {
                        const updated = interventions.filter(int => int.id !== id);
                        setInterventions(updated);
                        localStorage.setItem('gasInterventions', JSON.stringify(updated));
                    }
                };

                const filteredInterventions = interventions.filter(int =>
                    int.postNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    int.postName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    int.commune?.toLowerCase().includes(searchTerm.toLowerCase())
                );

                const startNewIntervention = (type) => {
                    setInterventionType(type);
                    setCurrentView('form');
                };

                // Header component
                const Header = () => h('div', null,
                    h('div', { className: 'bg-teal-700 text-white p-6 shadow-lg' },
                        h('h1', { className: 'text-3xl font-bold text-center' }, 'VPE COMPTEUR GAZ'),
                        h('p', { className: 'text-center mt-2 text-teal-100' }, 'Gestion des interventions sur compteurs')
                    ),
                    h('div', { className: 'bg-white shadow-md p-4' },
                        h('div', { className: 'max-w-7xl mx-auto flex flex-wrap gap-4 justify-between items-center' },
                            h('div', { className: 'flex gap-2' },
                                h('button', {
                                    onClick: () => setCurrentView('home'),
                                    className: `px-4 py-2 rounded flex items-center gap-2 ${currentView === 'home' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`
                                }, h(HomeIcon), ' Accueil'),
                                h('button', {
                                    onClick: () => setCurrentView('list'),
                                    className: `px-4 py-2 rounded ${currentView === 'list' ? 'bg-teal-600 text-white' : 'bg-gray-200'}`
                                }, 'Liste des interventions')
                            ),
                            h('div', { className: 'flex gap-2' },
                                h('button', {
                                    onClick: exportToCSV,
                                    className: 'px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2'
                                }, h(DownloadIcon), ' Exporter CSV'),
                                h('label', { className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer flex items-center gap-2' },
                                    h(UploadIcon), ' Importer CSV',
                                    h('input', {
                                        type: 'file',
                                        accept: '.csv',
                                        onChange: importFromCSV,
                                        className: 'hidden'
                                    })
                                )
                            )
                        )
                    )
                );

                // RENDER HOME
                if (currentView === 'home') {
                    return h('div', { className: 'min-h-screen bg-gray-50' },
                        h(Header),
                        h('div', { className: 'max-w-7xl mx-auto p-6' },
                            h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                                h('div', {
                                    onClick: () => startNewIntervention('VPE'),
                                    className: 'bg-white p-8 rounded-lg shadow-lg hover:shadow-xl transition-shadow cursor-pointer border-2 border-teal-200 hover:border-teal-500'
                                },
                                    h('div', { className: 'text-center' },
                                        h('div', { className: 'bg-teal-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4' },
                                            h(PlusIcon)
                                        ),
                                        h('h2', { className: 'text-2xl font-bold text-teal-700 mb-2' }, 'Intervention VPE'),
                                        h('p', { className: 'text-gray-600' }, 'Changement de compteur et maintenance compl√®te')
                                    )
                                ),
                                h('div', {
                                    onClick: () => startNewIntervention('Visite Pr√©alable'),
                                    className: 'bg-white p-8 rounded-lg shadow-lg hover:shadow-xl transition-shadow cursor-pointer border-2 border-purple-200 hover:border-purple-500'
                                },
                                    h('div', { className: 'text-center' },
                                        h('div', { className: 'bg-purple-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4' },
                                            h(PlusIcon)
                                        ),
                                        h('h2', { className: 'text-2xl font-bold text-purple-700 mb-2' }, 'Visite Pr√©alable'),
                                        h('p', { className: 'text-gray-600' }, 'Inspection et relev√© des informations du poste')
                                    )
                                )
                            )
                        )
                    );
                }

                // RENDER LIST
                if (currentView === 'list') {
                    return h('div', { className: 'min-h-screen bg-gray-50' },
                        h(Header),
                        h('div', { className: 'max-w-7xl mx-auto p-6' },
                            h('div', { className: 'mb-6 flex items-center gap-4' },
                                h('div', { className: 'flex-1 relative' },
                                    h('div', { className: 'absolute left-3 top-3' }, h(SearchIcon)),
                                    h('input', {
                                        type: 'text',
                                        placeholder: 'Rechercher par N¬∞ poste, nom ou commune...',
                                        value: searchTerm,
                                        onChange: (e) => setSearchTerm(e.target.value),
                                        className: 'w-full pl-10 pr-4 py-2 border rounded-lg'
                                    })
                                ),
                                h('div', { className: 'text-gray-600' }, `${filteredInterventions.length} intervention(s)`)
                            ),
                            h('div', { className: 'bg-white rounded-lg shadow overflow-hidden' },
                                h('div', { className: 'overflow-x-auto' },
                                    h('table', { className: 'w-full' },
                                        h('thead', { className: 'bg-gray-100' },
                                            h('tr', null,
                                                h('th', { className: 'px-4 py-3 text-left' }, 'Type'),
                                                h('th', { className: 'px-4 py-3 text-left' }, 'Date'),
                                                h('th', { className: 'px-4 py-3 text-left' }, 'N¬∞ Poste'),
                                                h('th', { className: 'px-4 py-3 text-left' }, 'Nom Poste'),
                                                h('th', { className: 'px-4 py-3 text-left' }, 'Commune'),
                                                h('th', { className: 'px-4 py-3 text-left' }, 'Actions')
                                            )
                                        ),
                                        h('tbody', null,
                                            filteredInterventions.map((int, idx) =>
                                                h('tr', {
                                                    key: int.id,
                                                    className: idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'
                                                },
                                                    h('td', { className: 'px-4 py-3' },
                                                        h('span', {
                                                            className: `px-2 py-1 rounded text-xs font-semibold ${
                                                                int.type === 'VPE' ? 'bg-teal-100 text-teal-700' : 'bg-purple-100 text-purple-700'
                                                            }`
                                                        }, int.type)
                                                    ),
                                                    h('td', { className: 'px-4 py-3' }, int.interventionDate),
                                                    h('td', { className: 'px-4 py-3' }, int.postNumber),
                                                    h('td', { className: 'px-4 py-3' }, int.postName),
                                                    h('td', { className: 'px-4 py-3' }, int.commune),
                                                    h('td', { className: 'px-4 py-3' },
                                                        h('button', {
                                                            onClick: () => deleteIntervention(int.id),
                                                            className: 'text-red-600 hover:text-red-800'
                                                        }, 'Supprimer')
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    );
                }

                // Helper pour cr√©er des champs de photo avec capture
                const createPhotoInput = (label, name) => {
                    return h('div', { className: 'border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-teal-500 transition-colors' },
                        formData[name] ? 
                            h('div', { className: 'relative' },
                                h('img', { 
                                    src: formData[name], 
                                    alt: label,
                                    className: 'w-full h-32 object-cover rounded mb-2'
                                }),
                                h('button', {
                                    type: 'button',
                                    onClick: () => setFormData(prev => ({ ...prev, [name]: '' })),
                                    className: 'text-xs text-red-600 hover:text-red-800'
                                }, 'Supprimer')
                            )
                        :
                            h('div', null,
                                h('div', { className: 'text-4xl mb-2' }, 'üì∑'),
                                h('label', { className: 'block text-sm font-medium mb-2' }, label),
                                h('label', { 
                                    className: 'inline-block px-4 py-2 bg-teal-600 text-white rounded cursor-pointer hover:bg-teal-700 text-sm'
                                },
                                    'Prendre une photo',
                                    h('input', {
                                        type: 'file',
                                        accept: 'image/*',
                                        capture: 'environment',
                                        onChange: (e) => handlePhotoCapture(e, name),
                                        className: 'hidden'
                                    })
                                )
                            )
                    );
                };

                // Helper pour cr√©er des champs input
                const createInput = (label, name, type = 'text', required = false, options = null) => {
                    return h('div', null,
                        h('label', { className: 'block text-sm font-medium mb-1' }, label),
                        options ? 
                            h('select', {
                                name: name,
                                value: formData[name],
                                onChange: handleInputChange,
                                className: 'w-full p-2 border rounded'
                            }, options.map(opt => h('option', { value: opt, key: opt }, opt)))
                        :
                            h('input', {
                                type: type,
                                name: name,
                                value: formData[name],
                                onChange: handleInputChange,
                                className: 'w-full p-2 border rounded',
                                required: required
                            })
                    );
                };

                // RENDER FORM VPE
                if (currentView === 'form' && interventionType === 'VPE') {
                    return h('div', { className: 'min-h-screen bg-gray-50' },
                        h(Header),
                        h('div', { className: 'max-w-7xl mx-auto p-6' },
                            h('form', { onSubmit: handleSubmit, className: 'space-y-6' },
                                // Titre
                                h('div', { className: 'bg-teal-50 p-4 rounded-lg border-2 border-teal-300' },
                                    h('h2', { className: 'text-2xl font-bold text-teal-800' }, 'INTERVENTION VPE')
                                ),
                                
                                // Informations de visite
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-teal-700' }, 'Informations de visite'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        createInput('Visite r√©alis√©e par', 'visitBy', 'text', true),
                                        createInput('Date d\'intervention', 'interventionDate', 'date', true),
                                        createInput('Heure d\'arriv√©e', 'arrivalTime', 'time'),
                                        createInput('Heure de d√©part', 'departureTime', 'time')
                                    )
                                ),

                                // Localisation
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-teal-700' }, 'Localisation du poste'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        createInput('N¬∞ du Poste', 'postNumber', 'text', true),
                                        createInput('Nom du Poste', 'postName'),
                                        createInput('Adresse', 'address'),
                                        createInput('Commune', 'commune')
                                    )
                                ),

                                // Compteur d√©pos√©
                                h('div', { className: 'bg-purple-50 p-6 rounded-lg shadow border-2 border-purple-300' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-800' }, 'COMPTEUR DE D√âPOS√â'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                                        createInput('Matricule compteur', 'removeMeterId'),
                                        createInput('Marque', 'removeMeterBrand'),
                                        createInput('Type', 'removeMeterType'),
                                        createInput('Ann√©e de fabrication', 'removeMeterYear'),
                                        createInput('Ann√©e du dernier √©talonnage', 'removeMeterLastCalib'),
                                        createInput('1 impulsion = (m3)', 'removeImpulsion'),
                                        createInput('Cat√©gorie', 'removeCategory', 'text', false, ['Membranes', 'Piston', 'Turbine']),
                                        createInput('Appellation', 'removeAppellation', 'text', false, ['G16', 'G25', 'G40', 'G65', 'G']),
                                        createInput('Nombre de roues avant virgule', 'removeWheelsBefore', 'number'),
                                        createInput('Nombre de roues apr√®s virgule', 'removeWheelsAfter', 'number'),
                                        createInput('Index', 'removeIndex'),
                                        h('div', { className: 'md:col-span-2' },
                                            createInput('Rubrique libre', 'removeFreeLabel')
                                        )
                                    )
                                ),

                                // Compteur pos√©
                                h('div', { className: 'bg-teal-50 p-6 rounded-lg shadow border-2 border-teal-300' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-teal-800' }, 'COMPTEUR DE POSE'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                                        createInput('Matricule compteur', 'installMeterId'),
                                        createInput('Marque', 'installMeterBrand'),
                                        createInput('Type', 'installMeterType'),
                                        createInput('Ann√©e de fabrication', 'installMeterYear'),
                                        createInput('Ann√©e du dernier √©talonnage', 'installMeterLastCalib'),
                                        createInput('1 impulsion = (m3)', 'installImpulsion'),
                                        createInput('Cat√©gorie', 'installCategory', 'text', false, ['Membranes', 'Piston', 'Turbine']),
                                        createInput('Appellation', 'installAppellation', 'text', false, ['G16', 'G25', 'G40', 'G65', 'G']),
                                        createInput('Nombre de roues avant virgule', 'installWheelsBefore', 'number'),
                                        createInput('Nombre de roues apr√®s virgule', 'installWheelsAfter', 'number'),
                                        createInput('Index', 'installIndex'),
                                        h('div', { className: 'md:col-span-2' },
                                            createInput('Rubrique libre', 'installFreeLabel')
                                        )
                                    )
                                ),

                                // T√©l√©rel√®ve
                                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                                    h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                        h('h2', { className: 'text-lg font-bold mb-4 text-purple-800' }, 'T√©l√©rel√®ve AVANT chgt compteur'),
                                        h('div', { className: 'space-y-3' },
                                            createInput('Ref ID', 'telerelevantBeforeRef'),
                                            createInput('N¬∞ de s√©rie', 'telerelevantBeforeSerial'),
                                            createInput('Index 1 relev√©', 'telerelevantBeforeIndex1'),
                                            createInput('Index 2 relev√©', 'telerelevantBeforeIndex2')
                                        )
                                    ),
                                    h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                        h('h2', { className: 'text-lg font-bold mb-4 text-teal-800' }, 'T√©l√©rel√®ve APRES chgt compteur'),
                                        h('div', { className: 'space-y-3' },
                                            createInput('N¬∞ de s√©rie', 'telerelevantAfterSerial'),
                                            createInput('Index 1 modifi√©', 'telerelevantAfterIndex1'),
                                            createInput('Index 2 modifi√©', 'telerelevantAfterIndex2')
                                        )
                                    )
                                ),

                                // Convertisseur
                                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                                    h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                        h('h2', { className: 'text-lg font-bold mb-4 text-purple-800' }, 'Convertisseur AVANT chgt de compteur'),
                                        h('div', { className: 'space-y-3' },
                                            createInput('Marque', 'converterBeforeBrand'),
                                            createInput('Index mesur√©', 'converterBeforeIndex'),
                                            createInput('Index base', 'converterBeforeBase')
                                        )
                                    ),
                                    h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                        h('h2', { className: 'text-lg font-bold mb-4 text-teal-800' }, 'Convertisseur APRES chgt de compteur'),
                                        h('div', { className: 'space-y-3' },
                                            createInput('N¬∞ de s√©rie', 'converterAfterSerial'),
                                            createInput('Index mesur√©', 'converterAfterIndex'),
                                            createInput('Index base', 'converterAfterBase')
                                        )
                                    )
                                ),

                                // Photos
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-teal-700' }, 'Photos (8 max)'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4' },
                                        createPhotoInput('Vue g√©n√©rale poste', 'photoVueGenerale'),
                                        createPhotoInput('Compteur d√©pos√©', 'photoCompteurDepose'),
                                        createPhotoInput('Compteur pos√©', 'photoCompteurPose'),
                                        createPhotoInput('√âtiquette DLV compteur pos√©', 'photoEtiquetteDLV'),
                                        createPhotoInput('Environnement PDL', 'photoEnvironnementPDL'),
                                        createPhotoInput('Convertisseur', 'photoConvertisseur'),
                                        createPhotoInput('T√©l√©rel√®ve AVANT', 'photoTelereleveAvant'),
                                        createPhotoInput('T√©l√©rel√®ve APR√àS', 'photoTelereleveApres')
                                    )
                                ),

                                // Entretien
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-teal-700' }, 'Entretien poste r√©alis√©'),
                                    h('div', null,
                                        h('label', { className: 'block text-sm font-medium mb-1' }, 'Description'),
                                        h('textarea', {
                                            name: 'maintenance',
                                            value: formData.maintenance,
                                            onChange: handleInputChange,
                                            rows: 4,
                                            className: 'w-full p-2 border rounded',
                                            placeholder: 'D√©tails de l\'entretien effectu√©...'
                                        })
                                    )
                                ),

                                // Boutons
                                h('div', { className: 'flex gap-4 justify-end' },
                                    h('button', {
                                        type: 'button',
                                        onClick: () => {
                                            if (confirm('Voulez-vous annuler ? Les donn√©es non sauvegard√©es seront perdues.')) {
                                                resetForm();
                                                setCurrentView('home');
                                            }
                                        },
                                        className: 'px-6 py-3 bg-gray-400 text-white rounded-lg hover:bg-gray-500'
                                    }, 'Annuler'),
                                    h('button', {
                                        type: 'submit',
                                        className: 'px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 flex items-center gap-2'
                                    }, h(SaveIcon), ' Enregistrer l\'intervention')
                                )
                            )
                        )
                    );
                }

                // RENDER FORM VISITE PREALABLE
                if (currentView === 'form' && interventionType === 'Visite Pr√©alable') {
                    return h('div', { className: 'min-h-screen bg-gray-50' },
                        h(Header),
                        h('div', { className: 'max-w-7xl mx-auto p-6' },
                            h('form', { onSubmit: handleSubmit, className: 'space-y-6' },
                                // Titre
                                h('div', { className: 'bg-purple-50 p-4 rounded-lg border-2 border-purple-300' },
                                    h('h2', { className: 'text-2xl font-bold text-purple-800' }, 'VISITE PR√âALABLE VPE COMPTEUR GAZ')
                                ),

                                // Informations de visite
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Informations de visite'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        createInput('Visite r√©alis√©e par', 'visitBy', 'text', true),
                                        createInput('Date', 'interventionDate', 'date', true)
                                    )
                                ),

                                // Localisation
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Localisation'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                        createInput('N¬∞ du Poste', 'postNumber', 'text', true),
                                        createInput('Nom du poste', 'postName'),
                                        createInput('Adresse', 'address'),
                                        createInput('Commune', 'commune')
                                    )
                                ),

                                // Informations du poste
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Informations du poste'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                                        createInput('PHOTO', 'photo'),
                                        createInput('SORTIE INFLUANCE', 'sortieInfluance'),
                                        createInput('PLAQUE VS', 'plaqueVS'),
                                        createInput('PLAQUE POSTE', 'plaquePoste'),
                                        createInput('CELLO', 'cello'),
                                        createInput('JOINT COMPTEUR (SG 00425 DN50)', 'jointCompteur'),
                                        createInput('JOINT TORIQUE (SG00768)', 'jointTorique'),
                                        createInput('JOINT PLAT (SG00769)', 'jointPlat'),
                                        createInput('JOINT TAMIS (SG 00777 DN50)', 'jointTamis'),
                                        createInput('FLITRE (SG00767)', 'flitre'),
                                        createInput('STAUBLI', 'staubli'),
                                        createInput('MAMELON MALE 1/4', 'mamelonMale'),
                                        createInput('TE LAITON/LAITON', 'teLaiton'),
                                        createInput('COMPTEUR', 'compteur'),
                                        createInput('ANTI-ROUILLE', 'antiRouille'),
                                        createInput('PEINTURE', 'peinture'),
                                        createInput('COULEUR (RAL)', 'couleurRAL')
                                    )
                                ),

                                // Boulons
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Boulons'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
                                        h('div', { className: 'md:col-span-3' },
                                            h('h3', { className: 'font-semibold mb-2' }, 'Entr√©e')
                                        ),
                                        createInput('Diam√®tre (Diam)', 'boulonsDiamEntree'),
                                        createInput('Longueur (Long)', 'boulonsLongEntree'),
                                        createInput('Quantit√©', 'boulonsEntree', 'number'),
                                        h('div', { className: 'md:col-span-3 mt-4' },
                                            h('h3', { className: 'font-semibold mb-2' }, 'Sortie')
                                        ),
                                        createInput('Diam√®tre (Diam)', 'boulonsDiamSortie'),
                                        createInput('Longueur (Long)', 'boulonsLongSortie'),
                                        createInput('Quantit√©', 'boulonsSortieQte', 'number')
                                    )
                                ),

                                // Dimensions
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Dimensions (cm)'),
                                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                                        h('div', null,
                                            h('h3', { className: 'font-semibold mb-3' }, 'Position des boulons'),
                                            h('div', { className: 'grid grid-cols-2 gap-4' },
                                                createInput('Haut', 'dimensionHaut'),
                                                createInput('Bas', 'dimensionBas'),
                                                createInput('Gauche', 'dimensionGauche'),
                                                createInput('Droite', 'dimensionDroite'),
                                                h('div', { className: 'col-span-2' },
                                                    createInput('Centre', 'dimensionCentre')
                                                )
                                            )
                                        ),
                                        h('div', null,
                                            h('h3', { className: 'font-semibold mb-3' }, 'Hauteur compteur'),
                                            createInput('Hauteur (cm)', 'hauteurCompteur')
                                        )
                                    )
                                ),

                                // Commentaires
                                h('div', { className: 'bg-white p-6 rounded-lg shadow' },
                                    h('h2', { className: 'text-xl font-bold mb-4 text-purple-700' }, 'Commentaires'),
                                    h('div', null,
                                        h('textarea', {
                                            name: 'commentaires',
                                            value: formData.commentaires,
                                            onChange: handleInputChange,
                                            rows: 4,
                                            className: 'w-full p-2 border rounded',
                                            placeholder: 'Notes et observations...'
                                        })
                                    )
                                ),

                                // Boutons
                                h('div', { className: 'flex gap-4 justify-end' },
                                    h('button', {
                                        type: 'button',
                                        onClick: () => {
                                            if (confirm('Voulez-vous annuler ? Les donn√©es non sauvegard√©es seront perdues.')) {
                                                resetForm();
                                                setCurrentView('home');
                                            }
                                        },
                                        className: 'px-6 py-3 bg-gray-400 text-white rounded-lg hover:bg-gray-500'
                                    }, 'Annuler'),
                                    h('button', {
                                        type: 'submit',
                                        className: 'px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2'
                                    }, h(SaveIcon), ' Enregistrer la visite pr√©alable')
                                )
                            )
                        )
                    );
                }

                return null;
            }

            const root = createRoot(document.getElementById('app'));
            root.render(h(App));
        });
    </script>
</body>
</html>
